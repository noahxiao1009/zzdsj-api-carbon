# çŸ¥è¯†åº“å¾®æœåŠ¡é«˜ç²¾åº¦æ£€ç´¢æ§åˆ¶å¼€å‘è§„åˆ’

## ğŸ“‹ ç°çŠ¶åˆ†æ

### åç«¯å¾®æœåŠ¡å®ç°ç¨‹åº¦
âœ… **å·²å®ŒæˆåŠŸèƒ½**ï¼š
- å®Œæ•´çš„çŸ¥è¯†åº“CRUDæ“ä½œAPI
- æ–‡æ¡£ä¸Šä¼ å’Œå¤„ç†æµç¨‹
- åŸºç¡€æœç´¢æ¥å£(æ”¯æŒLlamaIndexã€Agnoã€æ··åˆæ¨¡å¼)
- åµŒå…¥æœåŠ¡å’Œå‘é‡åŒ–å¤„ç†
- å¤šç§æ–‡æ¡£æ ¼å¼æ”¯æŒ(PDFã€Wordã€Excelã€CSVç­‰)
- URLå†…å®¹æŠ“å–åŠŸèƒ½

âš ï¸ **ç¼ºå¤±åŠŸèƒ½**ï¼š
- **å‘é‡æ•°æ®åº“ç´¢å¼•æ–¹å¼é€‰æ‹©** - ç¼ºå°‘HNSWã€FLATã€IVF_FLATç­‰ç´¢å¼•é…ç½®
- **é«˜ç²¾åº¦æ£€ç´¢å‚æ•°æ§åˆ¶** - å¬å›ç‡ã€æ··åˆæ£€ç´¢æƒé‡æ¯”ä¾‹è®¾ç½®ä¸å®Œæ•´
- **æ£€ç´¢æ–¹å¼é…ç½®** - æ··åˆã€è¯­ä¹‰ã€å…³é”®è¯æ£€ç´¢çš„å…·ä½“å®ç°
- **æ£€ç´¢æµ‹è¯•æ¥å£** - ä¸“é—¨çš„æµ‹è¯•å’Œè°ƒä¼˜æ¥å£

### å‰ç«¯é¡µé¢å®ç°ç¨‹åº¦
âœ… **å·²å®ŒæˆåŠŸèƒ½**ï¼š
- çŸ¥è¯†åº“åˆ—è¡¨å±•ç¤ºå’ŒåŸºç¡€ç®¡ç†
- çŸ¥è¯†åº“è¯¦æƒ…æŠ½å±‰é¢æ¿(æ¦‚è§ˆã€æ–‡ä»¶ã€æœç´¢æµ‹è¯•ã€è®¾ç½®å››ä¸ªæ ‡ç­¾é¡µ)
- åŸºç¡€çš„æœç´¢æµ‹è¯•ç•Œé¢
- ç®€å•çš„è®¾ç½®é…ç½®ç•Œé¢

âš ï¸ **éœ€è¦å®Œå–„åŠŸèƒ½**ï¼š
- **é«˜ç²¾åº¦æ£€ç´¢æ§åˆ¶é¢æ¿** - éœ€è¦æ›´ä¸“ä¸šçš„å‚æ•°è°ƒèŠ‚ç•Œé¢
- **ç´¢å¼•é…ç½®ç•Œé¢** - åˆ›å»ºçŸ¥è¯†åº“æ—¶çš„ç´¢å¼•æ–¹å¼é€‰æ‹©
- **å…¨å±€æ£€ç´¢æµ‹è¯•å¯¼èˆª** - ç‹¬ç«‹çš„æ£€ç´¢æµ‹è¯•æ¨¡å—
- **æ£€ç´¢å‚æ•°è°ƒä¼˜ç•Œé¢** - ä¸“ä¸šçš„å‚æ•°é…ç½®å’Œæµ‹è¯•ç•Œé¢

## ğŸ¯ å¼€å‘ç›®æ ‡

### é«˜ç²¾åº¦çŸ¥è¯†æ£€ç´¢æ§åˆ¶
1. **å¬å›ç‡æ§åˆ¶**ï¼šç²¾ç¡®æ§åˆ¶æ£€ç´¢ç»“æœçš„å¬å›ç‡
2. **æ··åˆæ£€ç´¢æƒé‡**ï¼šè¯­ä¹‰æ£€ç´¢å’Œå…³é”®è¯æ£€ç´¢çš„æƒé‡æ¯”ä¾‹
3. **æ£€ç´¢æ–¹å¼é€‰æ‹©**ï¼šæ··åˆã€çº¯è¯­ä¹‰ã€çº¯å…³é”®è¯ä¸‰ç§æ¨¡å¼
4. **ç´¢å¼•æ–¹å¼é…ç½®**ï¼šæ”¯æŒHNSWã€FLATã€IVF_FLATã€IVF_PQã€IVF_HNSW

### å‘é‡æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
1. **ç´¢å¼•ç±»å‹é€‰æ‹©**ï¼šåˆ›å»ºçŸ¥è¯†åº“æ—¶å¯é€‰æ‹©æœ€ä¼˜ç´¢å¼•æ–¹å¼
2. **æ€§èƒ½è°ƒä¼˜**ï¼šé’ˆå¯¹ä¸åŒåœºæ™¯çš„ç´¢å¼•å‚æ•°è°ƒä¼˜
3. **ç´¢å¼•é‡å»º**ï¼šæ”¯æŒåŠ¨æ€åˆ‡æ¢ç´¢å¼•æ–¹å¼

### æ£€ç´¢æµ‹è¯•åŠŸèƒ½
1. **å•çŸ¥è¯†åº“æµ‹è¯•**ï¼šæ¯ä¸ªçŸ¥è¯†åº“ç‹¬ç«‹çš„æ£€ç´¢æµ‹è¯•
2. **å…¨å±€æ£€ç´¢æµ‹è¯•**ï¼šè·¨çŸ¥è¯†åº“çš„æ£€ç´¢æµ‹è¯•
3. **æ€§èƒ½æŒ‡æ ‡å±•ç¤º**ï¼šå“åº”æ—¶é—´ã€å‡†ç¡®ç‡ç­‰æŒ‡æ ‡

## ğŸ“… å¼€å‘è®¡åˆ’

### Phase 1: åç«¯APIå¢å¼º (2-3å¤©)

#### 1.1 å‘é‡æ•°æ®åº“ç´¢å¼•é…ç½®
**æ–‡ä»¶**: `app/schemas/knowledge_schemas.py`
```python
# æ·»åŠ ç´¢å¼•ç±»å‹æšä¸¾
class VectorIndexType(str, Enum):
    HNSW = "hnsw"
    FLAT = "flat" 
    IVF_FLAT = "ivf_flat"
    IVF_PQ = "ivf_pq"
    IVF_HNSW = "ivf_hnsw"

# æ‰©å±•çŸ¥è¯†åº“åˆ›å»ºæ¨¡å‹
class KnowledgeBaseCreate(BaseModel):
    # ... ç°æœ‰å­—æ®µ ...
    vector_index_type: VectorIndexType = Field(default=VectorIndexType.HNSW)
    index_parameters: Optional[Dict[str, Any]] = Field(default_factory=dict)
```

#### 1.2 é«˜ç²¾åº¦æ£€ç´¢å‚æ•°
**æ–‡ä»¶**: `app/schemas/knowledge_schemas.py`
```python
# æ‰©å±•æœç´¢è¯·æ±‚æ¨¡å‹
class SearchRequest(BaseModel):
    # ... ç°æœ‰å­—æ®µ ...
    recall_threshold: float = Field(default=0.8, ge=0.0, le=1.0)
    search_type: Literal["hybrid", "semantic", "keyword"] = Field(default="hybrid")
    semantic_weight: float = Field(default=0.7, ge=0.0, le=1.0)
    keyword_weight: float = Field(default=0.3, ge=0.0, le=1.0)
    enable_re_ranking: bool = Field(default=True)
    max_candidates: int = Field(default=100, ge=10, le=500)
```

#### 1.3 æ–°å¢æ£€ç´¢æµ‹è¯•æ¥å£
**æ–‡ä»¶**: `app/api/knowledge_routes.py`
```python
@router.post("/{kb_id}/search/test")
async def test_search_performance(
    kb_id: str,
    test_queries: List[str],
    search_configs: List[SearchRequest]
) -> Dict[str, Any]:
    """æ‰¹é‡æµ‹è¯•ä¸åŒæ£€ç´¢é…ç½®çš„æ€§èƒ½"""
    pass

@router.get("/search/global-test")
async def global_search_test() -> Dict[str, Any]:
    """å…¨å±€æ£€ç´¢æµ‹è¯•é¡µé¢æ•°æ®"""
    pass
```

### Phase 2: å‰ç«¯æ£€ç´¢æ§åˆ¶é¢æ¿ (3-4å¤©)

#### 2.1 é«˜ç²¾åº¦æ£€ç´¢æ§åˆ¶ç»„ä»¶
**æ–°å»ºæ–‡ä»¶**: `src/components/modules/knowledge-base/SearchControlPanel.tsx`

ä¸»è¦åŠŸèƒ½ï¼š
- å¬å›ç‡æ»‘å—æ§åˆ¶ (0.1-1.0)
- æ£€ç´¢æ–¹å¼é€‰æ‹© (æ··åˆ/è¯­ä¹‰/å…³é”®è¯)
- æƒé‡æ¯”ä¾‹è°ƒèŠ‚ (è¯­ä¹‰:å…³é”®è¯ = 70:30 å¯è°ƒ)
- é«˜çº§å‚æ•°é…ç½® (é‡æ’åºã€å€™é€‰æ•°é‡ç­‰)
- å®æ—¶å‚æ•°é¢„è§ˆå’Œé‡ç½®åŠŸèƒ½

#### 2.2 ç´¢å¼•é…ç½®é€‰æ‹©å™¨
**æ–°å»ºæ–‡ä»¶**: `src/components/modules/knowledge-base/IndexConfigSelector.tsx`

ä¸»è¦åŠŸèƒ½ï¼š
- ç´¢å¼•ç±»å‹é€‰æ‹©å™¨ (HNSW/FLAT/IVF_FLAT/IVF_PQ/IVF_HNSW)
- ç´¢å¼•å‚æ•°é…ç½®è¡¨å•
- æ€§èƒ½å¯¹æ¯”è¯´æ˜
- æ¨èé…ç½®å»ºè®®

#### 2.3 æ£€ç´¢æµ‹è¯•é¡µé¢
**æ–°å»ºæ–‡ä»¶**: `src/pages/knowledge-base/SearchTestPage.tsx`

ä¸»è¦åŠŸèƒ½ï¼š
- æµ‹è¯•æŸ¥è¯¢è¾“å…¥åŒºåŸŸ
- å¤šé…ç½®å¹¶è¡Œæµ‹è¯•
- ç»“æœå¯¹æ¯”å±•ç¤º
- æ€§èƒ½æŒ‡æ ‡å›¾è¡¨
- é…ç½®å¯¼å‡º/å¯¼å…¥

### Phase 3: å¯¼èˆªå’Œé›†æˆ (1-2å¤©)

#### 3.1 æ›´æ–°çŸ¥è¯†åº“è¯¦æƒ…æŠ½å±‰
**ä¿®æ”¹æ–‡ä»¶**: `src/components/modules/knowledge-base/KnowledgeBaseDetailDrawer.tsx`

å¢å¼ºè®¾ç½®æ ‡ç­¾é¡µï¼š
- é›†æˆé«˜ç²¾åº¦æ£€ç´¢æ§åˆ¶é¢æ¿
- æ·»åŠ ç´¢å¼•é‡å»ºåŠŸèƒ½
- é…ç½®å†å²è®°å½•

#### 3.2 æ·»åŠ å…¨å±€æ£€ç´¢æµ‹è¯•å¯¼èˆª
**ä¿®æ”¹æ–‡ä»¶**: `src/routes/index.tsx`
```tsx
<Route path="/knowledge-base/search-test" element={
  <AuthGuard>
    <SearchTestPage />
  </AuthGuard>
} />
```

**ä¿®æ”¹æ–‡ä»¶**: ä¾§è¾¹æ å¯¼èˆªé…ç½®
æ·»åŠ "æ£€ç´¢æµ‹è¯•"å­å¯¼èˆªé¡¹

### Phase 4: APIå¯¹æ¥å’Œæ•°æ®è”è°ƒ (2å¤©)

#### 4.1 åˆ›å»ºAPIæœåŠ¡
**æ–°å»ºæ–‡ä»¶**: `src/utils/api/knowledge.ts`
```typescript
export const knowledgeAPI = {
  // çŸ¥è¯†åº“ç®¡ç†
  createKnowledgeBase: (data: CreateKnowledgeBaseRequest) => Promise<any>,
  updateSearchConfig: (id: string, config: SearchConfig) => Promise<any>,
  
  // æ£€ç´¢æµ‹è¯•
  testSearch: (id: string, params: SearchTestParams) => Promise<any>,
  globalSearchTest: (queries: string[]) => Promise<any>,
  
  // ç´¢å¼•ç®¡ç†
  rebuildIndex: (id: string, indexType: string) => Promise<any>,
  getIndexStatus: (id: string) => Promise<any>
};
```

#### 4.2 çŠ¶æ€ç®¡ç†é›†æˆ
**ä¿®æ”¹æ–‡ä»¶**: ç›¸å…³ç»„ä»¶
- æ·»åŠ loadingçŠ¶æ€ç®¡ç†
- é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- é…ç½®æ•°æ®æŒä¹…åŒ–

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. ç´¢å¼•é…ç½®å®ç°
```python
# åç«¯ç´¢å¼•é…ç½®å¤„ç†
VECTOR_INDEX_CONFIGS = {
    "hnsw": {
        "index_type": "HNSW",
        "metric_type": "COSINE", 
        "params": {"M": 16, "efConstruction": 200}
    },
    "ivf_flat": {
        "index_type": "IVF_FLAT",
        "metric_type": "COSINE",
        "params": {"nlist": 100}
    },
    # ... å…¶ä»–ç´¢å¼•é…ç½®
}
```

### 2. å‰ç«¯æ£€ç´¢æ§åˆ¶ç•Œé¢
```tsx
// æ£€ç´¢å‚æ•°æ§åˆ¶ç»„ä»¶
const SearchControlPanel = () => {
  const [searchType, setSearchType] = useState<'hybrid' | 'semantic' | 'keyword'>('hybrid');
  const [semanticWeight, setSemanticWeight] = useState(0.7);
  const [recallThreshold, setRecallThreshold] = useState(0.8);
  
  return (
    <div className="space-y-6">
      {/* æ£€ç´¢æ–¹å¼é€‰æ‹© */}
      <div className="grid grid-cols-3 gap-4">
        {['hybrid', 'semantic', 'keyword'].map(type => (
          <button 
            key={type}
            className={`p-4 border rounded-lg ${searchType === type ? 'border-blue-500 bg-blue-50' : 'border-gray-200'}`}
            onClick={() => setSearchType(type as any)}
          >
            {type === 'hybrid' ? 'æ··åˆæ£€ç´¢' : type === 'semantic' ? 'è¯­ä¹‰æ£€ç´¢' : 'å…³é”®è¯æ£€ç´¢'}
          </button>
        ))}
      </div>
      
      {/* æƒé‡æ§åˆ¶æ»‘å— */}
      {searchType === 'hybrid' && (
        <div className="space-y-4">
          <label className="block text-sm font-medium">è¯­ä¹‰æƒé‡: {semanticWeight}</label>
          <input 
            type="range" 
            min="0" 
            max="1" 
            step="0.1"
            value={semanticWeight}
            onChange={(e) => setSemanticWeight(parseFloat(e.target.value))}
            className="w-full"
          />
        </div>
      )}
      
      {/* å¬å›ç‡æ§åˆ¶ */}
      <div className="space-y-4">
        <label className="block text-sm font-medium">å¬å›ç‡é˜ˆå€¼: {recallThreshold}</label>
        <input 
          type="range" 
          min="0.1" 
          max="1" 
          step="0.05"
          value={recallThreshold}
          onChange={(e) => setRecallThreshold(parseFloat(e.target.value))}
          className="w-full"
        />
      </div>
    </div>
  );
};
```

### 3. æ£€ç´¢æµ‹è¯•åŠŸèƒ½
```tsx
// æ£€ç´¢æµ‹è¯•é¡µé¢
const SearchTestPage = () => {
  const [testResults, setTestResults] = useState<SearchTestResult[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  
  const runSearchTest = async (query: string, configs: SearchConfig[]) => {
    setIsLoading(true);
    try {
      const results = await Promise.all(
        configs.map(config => 
          knowledgeAPI.testSearch(selectedKB, { query, ...config })
        )
      );
      setTestResults(results);
    } catch (error) {
      message.error('æ£€ç´¢æµ‹è¯•å¤±è´¥');
    } finally {
      setIsLoading(false);
    }
  };
  
  return (
    <div className="space-y-6">
      {/* æµ‹è¯•é…ç½®åŒºåŸŸ */}
      <SearchTestConfigPanel onTest={runSearchTest} />
      
      {/* ç»“æœå¯¹æ¯”å±•ç¤º */}
      <SearchResultsComparison results={testResults} loading={isLoading} />
      
      {/* æ€§èƒ½æŒ‡æ ‡å›¾è¡¨ */}
      <PerformanceMetricsChart data={testResults} />
    </div>
  );
};
```

## ğŸ“Š éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] åˆ›å»ºçŸ¥è¯†åº“æ—¶å¯é€‰æ‹©ç´¢å¼•æ–¹å¼ (HNSWã€FLATã€IVF_FLATã€IVF_PQã€IVF_HNSW)
- [ ] æ£€ç´¢æ§åˆ¶é¢æ¿æ”¯æŒå¬å›ç‡ã€æƒé‡æ¯”ä¾‹ã€æ£€ç´¢æ–¹å¼é…ç½®
- [ ] å•çŸ¥è¯†åº“æ£€ç´¢æµ‹è¯•åŠŸèƒ½å®Œæ•´å¯ç”¨
- [ ] å…¨å±€æ£€ç´¢æµ‹è¯•å¯¼èˆªå·²æ·»åŠ å¹¶å¯è®¿é—®
- [ ] æ£€ç´¢æ€§èƒ½æŒ‡æ ‡å±•ç¤º (å“åº”æ—¶é—´ã€å¬å›ç‡ç­‰)
- [ ] é…ç½®å‚æ•°å¯ä¿å­˜å’Œé‡ç½®
- [ ] ç´¢å¼•é‡å»ºåŠŸèƒ½æ­£å¸¸å·¥ä½œ

### æ€§èƒ½éªŒæ”¶
- [ ] æ£€ç´¢å“åº”æ—¶é—´ < 500ms (å•æ¬¡æŸ¥è¯¢)
- [ ] æ”¯æŒå¹¶å‘æ£€ç´¢æµ‹è¯• (æœ€å¤š10ä¸ªé…ç½®åŒæ—¶æµ‹è¯•)
- [ ] å‰ç«¯å‚æ•°è°ƒèŠ‚å“åº”æµç•… (æ— æ˜æ˜¾å»¶è¿Ÿ)

### ç”¨æˆ·ä½“éªŒéªŒæ”¶
- [ ] ç•Œé¢è®¾è®¡ç¬¦åˆç°æœ‰è®¾è®¡è§„èŒƒ
- [ ] å‚æ•°è°ƒèŠ‚æœ‰å®æ—¶é¢„è§ˆæ•ˆæœ
- [ ] é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆå®Œæ•´
- [ ] å¸®åŠ©è¯´æ˜å’Œæ¨èé…ç½®æ¸…æ™°

## ğŸ“ å¼€å‘è¿›åº¦è·Ÿè¸ª

### Phase 1: åç«¯APIå¢å¼º
- [ ] 1.1 å‘é‡æ•°æ®åº“ç´¢å¼•é…ç½® - é¢„è®¡1å¤©
- [ ] 1.2 é«˜ç²¾åº¦æ£€ç´¢å‚æ•° - é¢„è®¡1å¤©  
- [ ] 1.3 æ–°å¢æ£€ç´¢æµ‹è¯•æ¥å£ - é¢„è®¡1å¤©

### Phase 2: å‰ç«¯æ£€ç´¢æ§åˆ¶é¢æ¿
- [ ] 2.1 é«˜ç²¾åº¦æ£€ç´¢æ§åˆ¶ç»„ä»¶ - é¢„è®¡1.5å¤©
- [ ] 2.2 ç´¢å¼•é…ç½®é€‰æ‹©å™¨ - é¢„è®¡1å¤©
- [ ] 2.3 æ£€ç´¢æµ‹è¯•é¡µé¢ - é¢„è®¡1.5å¤©

### Phase 3: å¯¼èˆªå’Œé›†æˆ
- [ ] 3.1 æ›´æ–°çŸ¥è¯†åº“è¯¦æƒ…æŠ½å±‰ - é¢„è®¡0.5å¤©
- [ ] 3.2 æ·»åŠ å…¨å±€æ£€ç´¢æµ‹è¯•å¯¼èˆª - é¢„è®¡0.5å¤©

### Phase 4: APIå¯¹æ¥å’Œæ•°æ®è”è°ƒ
- [ ] 4.1 åˆ›å»ºAPIæœåŠ¡ - é¢„è®¡1å¤©
- [ ] 4.2 çŠ¶æ€ç®¡ç†é›†æˆ - é¢„è®¡1å¤©

**æ€»é¢„è®¡å¼€å‘æ—¶é—´**: 8-10å¤©
**å½“å‰è¿›åº¦**: è§„åˆ’å®Œæˆï¼Œå‡†å¤‡å¼€å§‹Phase 1å¼€å‘

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**: Phase 1.1 å‘é‡æ•°æ®åº“ç´¢å¼•é…ç½®
2. **æŠ€æœ¯å‡†å¤‡**: ç¡®è®¤Milvus/PgVectorç´¢å¼•é…ç½®å‚æ•°
3. **ä»£ç å®¡æŸ¥**: ç°æœ‰æœç´¢æ¥å£çš„æ‰©å±•ç‚¹åˆ†æ
4. **æµ‹è¯•å‡†å¤‡**: å‡†å¤‡ä¸åŒç´¢å¼•ç±»å‹çš„æ€§èƒ½æµ‹è¯•ç”¨ä¾‹